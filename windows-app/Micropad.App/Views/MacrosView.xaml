<Page x:Class="Micropad.App.Views.MacrosView"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      Title="Macros"
      Background="{StaticResource BgPrimary}">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <Border Grid.Row="0" Background="{StaticResource BgSecondary}"
                Padding="24" BorderBrush="{StaticResource Border}" BorderThickness="0,0,0,1">
            <StackPanel>
                <TextBlock Text="Macro / Shortcut Builder" FontSize="24" FontWeight="SemiBold"
                          Foreground="{StaticResource TextPrimary}"/>
                <Border Height="3" Width="48" CornerRadius="2" Margin="0,6,0,0"
                        Background="{StaticResource BrandBlue}"/>
                <TextBlock Text="Click a key or encoder, then click tags or drag them onto the grid to build shortcuts."
                          FontSize="12" Foreground="{StaticResource TextSecondary}" Margin="0,10,0,0"/>
            </StackPanel>
        </Border>

        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="300"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- Left: Micropad grid (4 rows x 4 cols: E1,K1-K3 | K4-K7 | K8-K11 | K12,E2) -->
            <Border Grid.Column="0" Margin="20" Background="{StaticResource BgSecondary}"
                    BorderBrush="{StaticResource Border}" BorderThickness="1" CornerRadius="12" Padding="12">
                <StackPanel>
                    <TextBlock Text="Micropad grid" FontSize="14" FontWeight="SemiBold"
                              Foreground="{StaticResource TextPrimary}" Margin="0,0,0,10"/>
                    <Grid x:Name="MicropadGrid">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="64"/>
                            <RowDefinition Height="6"/>
                            <RowDefinition Height="64"/>
                            <RowDefinition Height="6"/>
                            <RowDefinition Height="64"/>
                            <RowDefinition Height="6"/>
                            <RowDefinition Height="64"/>
                        </Grid.RowDefinitions>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="6"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="6"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="6"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <Border Grid.Row="0" Grid.Column="0" Margin="0,0,1,1" Padding="4"
                                Background="{Binding SelectedSlotIndex, Converter={StaticResource SlotSelectedToBrushConverter}, ConverterParameter=12}"
                                BorderBrush="{Binding SelectedSlotIndex, Converter={StaticResource SlotSelectedToBrushConverter}, ConverterParameter=12;border}"
                                CornerRadius="6" BorderThickness="1" AllowDrop="True" Tag="12"
                                MouseLeftButtonDown="Slot_Click" DragOver="Slot_DragOver" Drop="Slot_Drop">
                            <StackPanel VerticalAlignment="Center">
                                <TextBlock Text="E1" FontSize="9" Foreground="{StaticResource TextSecondary}"/>
                                <TextBlock Text="{Binding Slots[12].DisplaySequence}" FontSize="8" Foreground="{StaticResource TextPrimary}"
                                          TextWrapping="Wrap" MaxHeight="20" TextTrimming="CharacterEllipsis"/>
                            </StackPanel>
                        </Border>
                        <Border Grid.Row="0" Grid.Column="2" Margin="1,0,1,1" Padding="4" Tag="0" AllowDrop="True"
                                Background="{Binding SelectedSlotIndex, Converter={StaticResource SlotSelectedToBrushConverter}, ConverterParameter=0}"
                                BorderBrush="{Binding SelectedSlotIndex, Converter={StaticResource SlotSelectedToBrushConverter}, ConverterParameter=0;border}"
                                CornerRadius="6" BorderThickness="1"
                                MouseLeftButtonDown="Slot_Click" DragOver="Slot_DragOver" Drop="Slot_Drop">
                            <StackPanel VerticalAlignment="Center">
                                <TextBlock Text="K1" FontSize="9" Foreground="{StaticResource TextSecondary}"/>
                                <TextBlock Text="{Binding Slots[0].DisplaySequence}" FontSize="8" Foreground="{StaticResource TextPrimary}" TextWrapping="Wrap" MaxHeight="20" TextTrimming="CharacterEllipsis"/>
                            </StackPanel>
                        </Border>
                        <Border Grid.Row="0" Grid.Column="4" Margin="1,0,1,1" Padding="4" Tag="1" AllowDrop="True"
                                Background="{Binding SelectedSlotIndex, Converter={StaticResource SlotSelectedToBrushConverter}, ConverterParameter=1}"
                                BorderBrush="{Binding SelectedSlotIndex, Converter={StaticResource SlotSelectedToBrushConverter}, ConverterParameter=1;border}"
                                CornerRadius="6" BorderThickness="1"
                                MouseLeftButtonDown="Slot_Click" DragOver="Slot_DragOver" Drop="Slot_Drop">
                            <StackPanel VerticalAlignment="Center">
                                <TextBlock Text="K2" FontSize="9" Foreground="{StaticResource TextSecondary}"/>
                                <TextBlock Text="{Binding Slots[1].DisplaySequence}" FontSize="8" Foreground="{StaticResource TextPrimary}" TextWrapping="Wrap" MaxHeight="20" TextTrimming="CharacterEllipsis"/>
                            </StackPanel>
                        </Border>
                        <Border Grid.Row="0" Grid.Column="6" Margin="1,0,0,1" Padding="4" Tag="2" AllowDrop="True"
                                Background="{Binding SelectedSlotIndex, Converter={StaticResource SlotSelectedToBrushConverter}, ConverterParameter=2}"
                                BorderBrush="{Binding SelectedSlotIndex, Converter={StaticResource SlotSelectedToBrushConverter}, ConverterParameter=2;border}"
                                CornerRadius="6" BorderThickness="1"
                                MouseLeftButtonDown="Slot_Click" DragOver="Slot_DragOver" Drop="Slot_Drop">
                            <StackPanel VerticalAlignment="Center">
                                <TextBlock Text="K3" FontSize="9" Foreground="{StaticResource TextSecondary}"/>
                                <TextBlock Text="{Binding Slots[2].DisplaySequence}" FontSize="8" Foreground="{StaticResource TextPrimary}" TextWrapping="Wrap" MaxHeight="20" TextTrimming="CharacterEllipsis"/>
                            </StackPanel>
                        </Border>

                        <Border Grid.Row="2" Grid.Column="0" Margin="0,1,1,1" Padding="4" Tag="3" AllowDrop="True"
                                Background="{Binding SelectedSlotIndex, Converter={StaticResource SlotSelectedToBrushConverter}, ConverterParameter=3}"
                                BorderBrush="{Binding SelectedSlotIndex, Converter={StaticResource SlotSelectedToBrushConverter}, ConverterParameter=3;border}"
                                CornerRadius="6" BorderThickness="1"
                                MouseLeftButtonDown="Slot_Click" DragOver="Slot_DragOver" Drop="Slot_Drop">
                            <StackPanel VerticalAlignment="Center">
                                <TextBlock Text="K4" FontSize="9" Foreground="{StaticResource TextSecondary}"/>
                                <TextBlock Text="{Binding Slots[3].DisplaySequence}" FontSize="8" Foreground="{StaticResource TextPrimary}" TextWrapping="Wrap" MaxHeight="20" TextTrimming="CharacterEllipsis"/>
                            </StackPanel>
                        </Border>
                        <Border Grid.Row="2" Grid.Column="2" Margin="1" Padding="4" Tag="4" AllowDrop="True"
                                Background="{Binding SelectedSlotIndex, Converter={StaticResource SlotSelectedToBrushConverter}, ConverterParameter=4}"
                                BorderBrush="{Binding SelectedSlotIndex, Converter={StaticResource SlotSelectedToBrushConverter}, ConverterParameter=4;border}"
                                CornerRadius="6" BorderThickness="1"
                                MouseLeftButtonDown="Slot_Click" DragOver="Slot_DragOver" Drop="Slot_Drop">
                            <StackPanel VerticalAlignment="Center">
                                <TextBlock Text="K5" FontSize="9" Foreground="{StaticResource TextSecondary}"/>
                                <TextBlock Text="{Binding Slots[4].DisplaySequence}" FontSize="8" Foreground="{StaticResource TextPrimary}" TextWrapping="Wrap" MaxHeight="20" TextTrimming="CharacterEllipsis"/>
                            </StackPanel>
                        </Border>
                        <Border Grid.Row="2" Grid.Column="4" Margin="1" Padding="4" Tag="5" AllowDrop="True"
                                Background="{Binding SelectedSlotIndex, Converter={StaticResource SlotSelectedToBrushConverter}, ConverterParameter=5}"
                                BorderBrush="{Binding SelectedSlotIndex, Converter={StaticResource SlotSelectedToBrushConverter}, ConverterParameter=5;border}"
                                CornerRadius="6" BorderThickness="1"
                                MouseLeftButtonDown="Slot_Click" DragOver="Slot_DragOver" Drop="Slot_Drop">
                            <StackPanel VerticalAlignment="Center">
                                <TextBlock Text="K6" FontSize="9" Foreground="{StaticResource TextSecondary}"/>
                                <TextBlock Text="{Binding Slots[5].DisplaySequence}" FontSize="8" Foreground="{StaticResource TextPrimary}" TextWrapping="Wrap" MaxHeight="20" TextTrimming="CharacterEllipsis"/>
                            </StackPanel>
                        </Border>
                        <Border Grid.Row="2" Grid.Column="6" Margin="1,1,0,1" Padding="4" Tag="6" AllowDrop="True"
                                Background="{Binding SelectedSlotIndex, Converter={StaticResource SlotSelectedToBrushConverter}, ConverterParameter=6}"
                                BorderBrush="{Binding SelectedSlotIndex, Converter={StaticResource SlotSelectedToBrushConverter}, ConverterParameter=6;border}"
                                CornerRadius="6" BorderThickness="1"
                                MouseLeftButtonDown="Slot_Click" DragOver="Slot_DragOver" Drop="Slot_Drop">
                            <StackPanel VerticalAlignment="Center">
                                <TextBlock Text="K7" FontSize="9" Foreground="{StaticResource TextSecondary}"/>
                                <TextBlock Text="{Binding Slots[6].DisplaySequence}" FontSize="8" Foreground="{StaticResource TextPrimary}" TextWrapping="Wrap" MaxHeight="20" TextTrimming="CharacterEllipsis"/>
                            </StackPanel>
                        </Border>

                        <Border Grid.Row="4" Grid.Column="0" Margin="0,1,1,1" Padding="4" Tag="7" AllowDrop="True"
                                Background="{Binding SelectedSlotIndex, Converter={StaticResource SlotSelectedToBrushConverter}, ConverterParameter=7}"
                                BorderBrush="{Binding SelectedSlotIndex, Converter={StaticResource SlotSelectedToBrushConverter}, ConverterParameter=7;border}"
                                CornerRadius="6" BorderThickness="1"
                                MouseLeftButtonDown="Slot_Click" DragOver="Slot_DragOver" Drop="Slot_Drop">
                            <StackPanel VerticalAlignment="Center">
                                <TextBlock Text="K8" FontSize="9" Foreground="{StaticResource TextSecondary}"/>
                                <TextBlock Text="{Binding Slots[7].DisplaySequence}" FontSize="8" Foreground="{StaticResource TextPrimary}" TextWrapping="Wrap" MaxHeight="20" TextTrimming="CharacterEllipsis"/>
                            </StackPanel>
                        </Border>
                        <Border Grid.Row="4" Grid.Column="2" Margin="1" Padding="4" Tag="8" AllowDrop="True"
                                Background="{Binding SelectedSlotIndex, Converter={StaticResource SlotSelectedToBrushConverter}, ConverterParameter=8}"
                                BorderBrush="{Binding SelectedSlotIndex, Converter={StaticResource SlotSelectedToBrushConverter}, ConverterParameter=8;border}"
                                CornerRadius="6" BorderThickness="1"
                                MouseLeftButtonDown="Slot_Click" DragOver="Slot_DragOver" Drop="Slot_Drop">
                            <StackPanel VerticalAlignment="Center">
                                <TextBlock Text="K9" FontSize="9" Foreground="{StaticResource TextSecondary}"/>
                                <TextBlock Text="{Binding Slots[8].DisplaySequence}" FontSize="8" Foreground="{StaticResource TextPrimary}" TextWrapping="Wrap" MaxHeight="20" TextTrimming="CharacterEllipsis"/>
                            </StackPanel>
                        </Border>
                        <Border Grid.Row="4" Grid.Column="4" Margin="1" Padding="4" Tag="9" AllowDrop="True"
                                Background="{Binding SelectedSlotIndex, Converter={StaticResource SlotSelectedToBrushConverter}, ConverterParameter=9}"
                                BorderBrush="{Binding SelectedSlotIndex, Converter={StaticResource SlotSelectedToBrushConverter}, ConverterParameter=9;border}"
                                CornerRadius="6" BorderThickness="1"
                                MouseLeftButtonDown="Slot_Click" DragOver="Slot_DragOver" Drop="Slot_Drop">
                            <StackPanel VerticalAlignment="Center">
                                <TextBlock Text="K10" FontSize="9" Foreground="{StaticResource TextSecondary}"/>
                                <TextBlock Text="{Binding Slots[9].DisplaySequence}" FontSize="8" Foreground="{StaticResource TextPrimary}" TextWrapping="Wrap" MaxHeight="20" TextTrimming="CharacterEllipsis"/>
                            </StackPanel>
                        </Border>
                        <Border Grid.Row="4" Grid.Column="6" Margin="1,1,0,1" Padding="4" Tag="10" AllowDrop="True"
                                Background="{Binding SelectedSlotIndex, Converter={StaticResource SlotSelectedToBrushConverter}, ConverterParameter=10}"
                                BorderBrush="{Binding SelectedSlotIndex, Converter={StaticResource SlotSelectedToBrushConverter}, ConverterParameter=10;border}"
                                CornerRadius="6" BorderThickness="1"
                                MouseLeftButtonDown="Slot_Click" DragOver="Slot_DragOver" Drop="Slot_Drop">
                            <StackPanel VerticalAlignment="Center">
                                <TextBlock Text="K11" FontSize="9" Foreground="{StaticResource TextSecondary}"/>
                                <TextBlock Text="{Binding Slots[10].DisplaySequence}" FontSize="8" Foreground="{StaticResource TextPrimary}" TextWrapping="Wrap" MaxHeight="20" TextTrimming="CharacterEllipsis"/>
                            </StackPanel>
                        </Border>

                        <Border Grid.Row="6" Grid.Column="0" Margin="0,1,1,0" Padding="4" Tag="11" AllowDrop="True"
                                Background="{Binding SelectedSlotIndex, Converter={StaticResource SlotSelectedToBrushConverter}, ConverterParameter=11}"
                                BorderBrush="{Binding SelectedSlotIndex, Converter={StaticResource SlotSelectedToBrushConverter}, ConverterParameter=11;border}"
                                CornerRadius="6" BorderThickness="1"
                                MouseLeftButtonDown="Slot_Click" DragOver="Slot_DragOver" Drop="Slot_Drop">
                            <StackPanel VerticalAlignment="Center">
                                <TextBlock Text="K12" FontSize="9" Foreground="{StaticResource TextSecondary}"/>
                                <TextBlock Text="{Binding Slots[11].DisplaySequence}" FontSize="8" Foreground="{StaticResource TextPrimary}" TextWrapping="Wrap" MaxHeight="20" TextTrimming="CharacterEllipsis"/>
                            </StackPanel>
                        </Border>
                        <Border Grid.Row="6" Grid.Column="2" Margin="1,1,1,0" Padding="4" Tag="13" AllowDrop="True"
                                Background="{Binding SelectedSlotIndex, Converter={StaticResource SlotSelectedToBrushConverter}, ConverterParameter=13}"
                                BorderBrush="{Binding SelectedSlotIndex, Converter={StaticResource SlotSelectedToBrushConverter}, ConverterParameter=13;border}"
                                CornerRadius="6" BorderThickness="1"
                                MouseLeftButtonDown="Slot_Click" DragOver="Slot_DragOver" Drop="Slot_Drop">
                            <StackPanel VerticalAlignment="Center">
                                <TextBlock Text="E2" FontSize="9" Foreground="{StaticResource TextSecondary}"/>
                                <TextBlock Text="{Binding Slots[13].DisplaySequence}" FontSize="8" Foreground="{StaticResource TextPrimary}" TextWrapping="Wrap" MaxHeight="20" TextTrimming="CharacterEllipsis"/>
                            </StackPanel>
                        </Border>
                    </Grid>

                    <TextBlock Text="Selected slot sequence" FontSize="11" Foreground="{StaticResource TextSecondary}" Margin="0,12,0,4"/>
                    <TextBox Text="{Binding SelectedSequence, UpdateSourceTrigger=PropertyChanged}"
                             Height="56" TextWrapping="Wrap" AcceptsReturn="True"
                             Background="{StaticResource BgInput}" Foreground="{StaticResource TextPrimary}"
                             Padding="8" Margin="0,0,0,8"/>
                </StackPanel>
            </Border>

            <!-- Right: Tag palette (grouped, scrollable, click + drag) -->
            <ScrollViewer Grid.Column="1" VerticalScrollBarVisibility="Auto" Padding="16">
                <StackPanel>
                    <TextBlock Text="Click a tag to append to selected slot, or drag onto a grid cell" FontSize="12"
                              Foreground="{StaticResource TextSecondary}" Margin="0,0,0,12"/>
                    <ItemsControl ItemsSource="{Binding AllTags}">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <WrapPanel/>
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border Margin="2" Padding="6,4" CornerRadius="4" Cursor="Hand"
                                        Background="{StaticResource BgTertiary}"
                                        BorderBrush="{StaticResource Border}" BorderThickness="1"
                                        PreviewMouseLeftButtonDown="Tag_PreviewMouseLeftButtonDown"
                                        PreviewMouseMove="Tag_PreviewMouseMove"
                                        PreviewMouseLeftButtonUp="Tag_PreviewMouseLeftButtonUp">
                                    <Border.ToolTip>
                                        <ToolTip Content="{Binding Tag}"/>
                                    </Border.ToolTip>
                                    <TextBlock Text="{Binding Display}" FontSize="11"
                                              Foreground="{StaticResource TextPrimary}"/>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </StackPanel>
            </ScrollViewer>
        </Grid>
    </Grid>
</Page>
